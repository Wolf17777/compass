{% extends '../base_component.html' %}

{% block css %}
<style>
.show-pass-right{
    position: absolute;
    top: 25%;
    right: 0;
    width: 16%;
    height: 50%;
}

.show-pass svg{
    cursor: pointer;
}
.eye-slash .icon-eye{
    display: none;
}
.show-pass .icon-eye-slash{
    display: none;
}
.eye-slash .icon-eye-slash{
    display: revert;
}

.clipboard.success .success-hide {
    display: none !important;
}
.clipboard .success-show {
    display: none;
}
.clipboard.success .success-show {
    display: revert;
}
.clipboard .success-show-flex {
    display: none;
}
.clipboard.success .success-show-flex {
    display: flex;
}
</style>
{% endblock %}

{% block svg_shortcuts %}
<symbol id="bi-eye" viewBox="0 0 16 16">
    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
</symbol>
<symbol id="bi-eye-slash" viewBox="0 0 16 16">
    <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
    <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
    <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
</symbol>
<symbol id="bi-clipboard" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"/>
  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
</symbol>
<symbol id="bi-clipboard-check" viewBox="0 0 16 16">
  <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
</symbol>
<symbol id="bi-compass" viewBox="0 0 16 16">
  <path d="M8 16.016a7.5 7.5 0 0 0 1.962-14.74A1 1 0 0 0 9 0H7a1 1 0 0 0-.962 1.276A7.5 7.5 0 0 0 8 16.016zm6.5-7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
  <path d="m6.94 7.44 4.95-2.83-2.83 4.95-4.949 2.83 2.828-4.95z"/>
</symbol>
{% endblock %}

{% block script_global %}
<script>
function generatePassword(length=24) {
  _pattern = /[a-zA-Z0-9_\-\+\.]/;
  
  return Array.apply(null, {'length': length})
    .map(function()
    {
      var result;
      while(true) 
      {
        result = String.fromCharCode(window.crypto.getRandomValues(new Uint8Array(1))[0]);
        if(this._pattern.test(result))
        {
          return result;
        }
      }        
    }, this)
    .join('');  
}    

function password_toggle_eye(){
    let eye = this;
    //let input_password = $("#{{component_id}}");
    let input_password = $(eye).parent().find("input");
    if(input_password.attr("type") == "password"){
        input_password.attr("type","text")
        $(eye).addClass('eye-slash');
    }else{
        input_password.attr("type","password");
        $(eye).removeClass('eye-slash');
    }
    input_password.trigger( "focus" );
}
function copy_to_clipboard(event) { // target='input'
    let button=$(this); //$('#'+elemid);
    if (button.hasClass('success-hide')) {
        $('.clipboard').removeClass('success');
        button.parent().addClass('success');
        setTimeout( function() { 
            button.parent().removeClass('success');
        }, 10000);
    }
    let target = '';
    if (event.data == undefined) target = 'input';
    else target = event.data.target;
    let target_el = button.parent().find(target);
    if (target_el.val()!='') navigator.clipboard.writeText(target_el.val());
    else navigator.clipboard.writeText(target_el.html());
}
function generate_password_for_input(event) {
    $('#'+event.data.inputid).val(generatePassword());
    $('#'+event.data.inputid).trigger("input");
}
</script>
{% endblock %}

{% block html %}
<div id="{{component_id}}_div" class="{% if clipboard or generate_button %}clipboard{% endif %} input-group">
    <div class='form-floating'>
        <input type="password" maxlength="250" placeholder="" id="{{component_id}}" name="{{component_id}}" class="form-control" {% if not_required %}{% else %}required{% endif %} {% if readonly %}readonly{% endif %}>
        <span class="show-pass show-pass-right">
            <svg class="icon-eye bi w-100 h-100"><use xlink:href="#bi-eye"/></svg>
            <svg class="icon-eye-slash bi w-100 h-100"><use xlink:href="#bi-eye-slash"/></svg>
        </span>
        <label for="{{component_id}}" class="form-label">{{input_password_label|default:translations.password}}</label>
    </div>
    {% if clipboard %}
    <button type="button" class="btn btn-dark success-hide"    title="Copy to clipboard" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Copy to clipboard">
        <svg class="bi" width='1.8rem' height='1.8rem'><use xlink:href="#bi-clipboard"/></svg>
    </button><button type="button" class="btn btn-success success-show" title="Copied!" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Copied!">
        <svg class="bi" width='1.8rem' height='1.8rem'><use xlink:href="#bi-clipboard-check"/></svg>
    </button>
    {% endif %}
    {% if generate_button %}
    <button id='{{component_id}}_generate_button' type="button" class="btn btn-dark" title="Generate" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Generate">
        <svg class="bi clipboard" width='1.8rem' height='1.8rem'><use xlink:href="#bi-compass"/></svg>
    </button>
    {% endif %}
</div>
{% endblock %}

{% block script_local %}
<script>
$("#{{component_id}}_div").find('.show-pass').on('click', password_toggle_eye);
$("#{{component_id}}_div").find('.success-hide').on('click', copy_to_clipboard);
$("#{{component_id}}_div").find('.success-show').on('click', copy_to_clipboard);
$("#{{component_id}}_generate_button").on('click', {inputid: "{{component_id}}" }, generate_password_for_input);
</script>
{% endblock %}
